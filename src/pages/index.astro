---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import TipCard from '../components/TipCard.astro';

const includeDrafts = import.meta.env.DEV;
const entries = await getCollection('blog', ({ data }) => includeDrafts || !data.draft);

const latestTips = entries
  .filter((entry) => entry.data.kind === 'tip')
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 6);

const latestPosts = entries
  .filter((entry) => entry.data.kind === 'post')
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 6);
---

<BaseLayout title="DataSaaSLab">
  <section class="hero hero-bg">
    <div class="hero-content">
      <h1>DataSaaSLab</h1>
      <p class="hero-subtitle">
        AI-assisted writing with human quality gates. Browse quick tips or go deep with long-form technical posts.
      </p>
      <div class="cta-row">
        <a class="button" href="/tips">Explore Tips</a>
        <a class="button button-secondary" href="/blog">Read Blog Posts</a>
      </div>
    </div>
  </section>

  <section class="latest-block">
    <h2>Latest Tips</h2>
    {latestTips.length === 0 ? (
      <p>No tips yet.</p>
    ) : (
      <div class="section-grid">
        {latestTips.map((tip) => {
          const slug = tip.id.split('/').pop() ?? tip.id;
          const href = `/${tip.data.lang}/blog/${slug}`;
          return (
            <TipCard
              href={href}
              title={tip.data.title}
              description={tip.data.description}
              date={tip.data.date}
              lang={tip.data.lang}
            />
          );
        })}
      </div>
    )}
  </section>

  <section class="latest-block">
    <h2>Latest Posts</h2>
    {latestPosts.length === 0 ? (
      <p>No posts yet.</p>
    ) : (
      <div class="section-grid">
        {latestPosts.map((post) => {
          const slug = post.id.split('/').pop() ?? post.id;
          const href = `/${post.data.lang}/blog/${slug}`;
          return (
            <PostCard
              href={href}
              title={post.data.title}
              description={post.data.description}
              date={post.data.date}
              lang={post.data.lang}
            />
          );
        })}
      </div>
    )}
  </section>
</BaseLayout>
